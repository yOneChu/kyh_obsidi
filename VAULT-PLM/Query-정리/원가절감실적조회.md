

---

```
select  crdat ERP전송일자,  woknum 공사번호,  decode(bom.matnr,bom.woknum,'*', bom.matnr) 상위자재,  idnrk 자재번호,  menge 수량,  dzeinr 도면번호,  matkl 블럭번호,  md$desc 공사명,  
        (select des from doscoditm where ouid=EL_ATYP) "EL_ATYP",  EL_AMAN "EL_AMAN",  (select des from doscoditm where ouid=EL_ACAPA) "EL_ACAPA",  
        (select des from doscoditm where ouid=EL_AUSE) "EL_AUSE",  (select des from doscoditm where ouid=EL_ASPD) "EL_ASPD",  EL_AFQ "EL_AFQ",  EL_EHTH "EL_EHTH",  EL_EHO "EL_EHO",  EL_BFTH "EL_BFTH",  
        (select des from doscoditm where ouid=EL_BKPL) "EL_BKPL",  (select des from doscoditm where ouid=EL_DVS) "EL_DVS",  (select des from doscoditm where ouid=EL_ECRL) "EL_ECRL",  EL_ETMINV "EL_ETMINV",  
        (select des from doscoditm where ouid=EL_DLATT) "EL_DLATT",  (select des from doscoditm where ouid=EL_BMOPB) "EL_BMOPB",  (select des from doscoditm where ouid=EL_EMRLHSCP) "EL_EMRLHSCP",  
        (select des from doscoditm where ouid=EL_ETM) "EL_ETM",  (select des from doscoditm where ouid=EL_ECSF) "EL_ECSF",  EL_EHTRH "EL_EHTRH",  (select des from doscoditm where ouid=EL_AGRS) "EL_AGRS",  
        (select des from doscoditm where ouid=EL_DSV1) "EL_DSV1",  (select des from doscoditm where ouid=EL_DRV) "EL_DRV",  EL_ECW "EL_ECW",  EL_ECJJ "EL_ECJJ",  
        (select des from doscoditm where ouid=EL_ERPW) "EL_ERPW",  c.manager_m 기계담당자,  c.manager_e 전기담당자  
from (  select crdat,woknum,matnr, idnrk,menge,dzeinr,matkl  
from  (  select /*+ INDEX_COMBINE(A) */ a.*,row_number() over(partition by woknum,matnr,idnrk,matkl order by nvl(a.wokver,-1) desc, a.crdat desc, a.seqno desc) rn from eai_bom a,  (select woknum first_woknum,matnr first_matnr, idnrk first_idnrk,matkl first_matkl  
    from eai_bom first    where  (  idnrk = '1010101010'  ) and  
                                 matkl = 'B259C01' and  prctyp in ('A','N') and  crdat between '20241127' and '20251127' and tp_status = 'T' and woknum not like 'TEST-%'  ) s  
    where a.woknum = s.first_woknum  and   a.matnr = s.first_matnr  and   a.idnrk = s.first_idnrk  and   a.matkl = s.first_matkl  and   (A.CTYP is null or a.ctyp <> 'T')  and   a.tp_status='T'  )where rn=1  and prctyp<>'D'  and tp_status='T'  ) bom  
    left outer join elv_info$vf c  on bom.woknum = c.md$number  
     where  c.vf$ouid is null or  (  c.vf$ouid in (select id$last from elv_info$id where id$ouid=vf$identity)  
                                        and c.EL_ATYP in (select ouid from doscoditm where des like '%GTLX%') -- 기종  
                                        and c.EL_ETM in (select ouid from doscoditm where des like '%EE%') -- TM  
                                  )  
     union  
        select  crdat ERP전송일자,  woknum 공사번호,  decode(bom.matnr,bom.woknum,'*', bom.matnr) 상위자재,  idnrk 자재번호,  menge 수량,  dzeinr 도면번호,  matkl 블럭번호,  md$desc 공사명,  (select des from doscoditm where ouid=EL_ATYP) "EL_ATYP",  EL_AMAN "EL_AMAN",  (select des from doscoditm where ouid=EL_ACAPA) "EL_ACAPA",  
            (select des from doscoditm where ouid=EL_AUSE) "EL_AUSE",  (select des from doscoditm where ouid=EL_ASPD) "EL_ASPD",  EL_AFQ "EL_AFQ",  EL_EHTH "EL_EHTH",  EL_EHO "EL_EHO",  EL_BFTH "EL_BFTH",  
     (select des from doscoditm where ouid=EL_BKPL) "EL_BKPL",  (select des from doscoditm where ouid=EL_DVS) "EL_DVS",  (select des from doscoditm where ouid=EL_ECRL) "EL_ECRL",  EL_ETMINV "EL_ETMINV",  (select des from doscoditm where ouid=EL_DLATT) "EL_DLATT",  
     (select des from doscoditm where ouid=EL_BMOPB) "EL_BMOPB",  (select des from doscoditm where ouid=EL_EMRLHSCP) "EL_EMRLHSCP",  (select des from doscoditm where ouid=EL_ETM) "EL_ETM",  
     (select des from doscoditm where ouid=EL_ECSF) "EL_ECSF",  EL_EHTRH "EL_EHTRH",  (select des from doscoditm where ouid=EL_AGRS) "EL_AGRS",  (select des from doscoditm where ouid=EL_DSV1) "EL_DSV1",  (select des from doscoditm where ouid=EL_DRV) "EL_DRV",  EL_ECW "EL_ECW",  EL_ECJJ "EL_ECJJ",  
     (select des from doscoditm where ouid=EL_ERPW) "EL_ERPW",  c.manager_m 기계담당자,  c.manager_e 전기담당자 from (  select crdat,woknum,matnr, idnrk,menge,dzeinr,matkl  
from  (  select /*+ INDEX_COMBINE(A) */ a.*,row_number() over(partition by woknum,matnr,idnrk,matkl order by nvl(a.wokver,-1) desc, a.crdat desc, a.seqno desc) rn from eai_bom_body a,  
 (select woknum first_woknum,matnr first_matnr, idnrk first_idnrk,matkl first_matkl  from eai_bom_body first  
 where  (  idnrk IN ('1010101010')  ) and  
        matkl = 'B259C01' and  prctyp in ('A','N') and  crdat between '20241127' and '20251127' and woknum not like 'TEST-%'  ) s where a.woknum = s.first_woknum  and   a.matnr = s.first_matnr  and   a.idnrk = s.first_idnrk  and   a.matkl = s.first_matkl  and  
      (A.CTYP is null or a.ctyp <> 'T')  )where rn=1  and prctyp<>'D'  ) bom  left outer   join elv_info$vf c  on bom.woknum = c.md$number  
  where  c.vf$ouid is null or  (  c.vf$ouid in (select id$last from elv_info$id where id$ouid=vf$identity)  
                                      and c.EL_ATYP in (select ouid from doscoditm where des like '%GTLX%') -- 기종  
                                      and c.EL_ETM in (select ouid from doscoditm where des like '%EE%') -- TM  
                                )  
 FETCH NEXT 10000 ROWS ONLY

```
